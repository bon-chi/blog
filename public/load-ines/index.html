<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title>bon-chi</title>

      <!-- CSS -->
      <link rel="stylesheet" href="http:&#x2F;&#x2F;127.0.0.1:1111&#x2F;print.css" media="print">
      <link rel="stylesheet" href="http:&#x2F;&#x2F;127.0.0.1:1111&#x2F;poole.css">
      <link rel="stylesheet" href="http:&#x2F;&#x2F;127.0.0.1:1111&#x2F;hyde.css">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

      

      
      
    </head>

    <body class="theme-base-0c ">
        
            <div class="sidebar">
                <div class="container sidebar-sticky">
                    <div class="sidebar-about">
                        
                            <a href="http:&#x2F;&#x2F;127.0.0.1:1111&#x2F;"><h1>bon-chi</h1></a>
                            
                            <p class="lead">bon-chi&#x27;s web log</p>
                            
                        
                    </div>

                    <ul class="sidebar-nav">
                        
                        
                        
                    </ul>
                </div>
            </div>
        

        <div class="content container">
            
<ul>
  
      <li>
          <a href="http://127.0.0.1:1111/load-ines/#first-of-all">First of all</a>
          
      </li>
  
      <li>
          <a href="http://127.0.0.1:1111/load-ines/#two-parts-of-ines">Two parts of iNES</a>
          
      </li>
  
      <li>
          <a href="http://127.0.0.1:1111/load-ines/#prg">PRG_RAM and V_RAM</a>
          
      </li>
  
      <li>
          <a href="http://127.0.0.1:1111/load-ines/#init-project">init project</a>
          
      </li>
  
      <li>
          <a href="http://127.0.0.1:1111/load-ines/#nes-module">nes module</a>
          
              <ul>
                  
                      <li>
                          <a href="http://127.0.0.1:1111/load-ines/#cpu">CPU</a>
                      </li>
                  
                      <li>
                          <a href="http://127.0.0.1:1111/load-ines/#ppu">PPU</a>
                      </li>
                  
              </ul>
          
      </li>
  
      <li>
          <a href="http://127.0.0.1:1111/load-ines/#debug">debug</a>
          
      </li>
  
</ul>
<div class="post">
  <h1 class="post-title">load iNES</h1>
  <span class="post-date">2018-02-27</span>
  <h2 id="first-of-all"><a class="gutenberg-anchor" href="#first-of-all" aria-label="Anchor link for: first-of-all">ðŸ”—</a>
First of all</h2>
<p>NES consists of some parts. For example CPU, PPU, APU and so on. I start from loading iNES file,  which is a format of NES binary programs. You can check iNES format <a href="http://wiki.nesdev.com/w/index.php/INES">here</a>.</p>
<h2 id="two-parts-of-ines"><a class="gutenberg-anchor" href="#two-parts-of-ines" aria-label="Anchor link for: two-parts-of-ines">ðŸ”—</a>
Two parts of iNES</h2>
<p>iNES have two parts. PRG_ROM and CHR_ROM. PRG_ROM is for game logic and CHR_ROM is for graphic. When iNES is loaded, PRG_RAM load PRG_ROM data and V_RAM load CHR_ROM.</p>
<h2 id="prg"><a class="gutenberg-anchor" href="#prg" aria-label="Anchor link for: prg">ðŸ”—</a>
PRG_RAM and V_RAM</h2>
<p>PRG_RAM and V_RAM has 2KB memory.</p>
<h2 id="init-project"><a class="gutenberg-anchor" href="#init-project" aria-label="Anchor link for: init-project">ðŸ”—</a>
init project</h2>
<pre style="background-color:#2b303b">
<span style="background-color:#2b303b;color:#c0c5ce;">% cargo init --bin nes
</span><span style="background-color:#2b303b;color:#c0c5ce;">% cd nes
</span></pre><h2 id="nes-module"><a class="gutenberg-anchor" href="#nes-module" aria-label="Anchor link for: nes-module">ðŸ”—</a>
nes module</h2>
<p>This is the today's directory structure.</p>
<pre style="background-color:#2b303b">
<span style="background-color:#2b303b;color:#c0c5ce;">% tree
</span><span style="background-color:#2b303b;color:#c0c5ce;">.
</span><span style="background-color:#2b303b;color:#c0c5ce;">â”œâ”€â”€ lib.rs
</span><span style="background-color:#2b303b;color:#c0c5ce;">â”œâ”€â”€ main.rs
</span><span style="background-color:#2b303b;color:#c0c5ce;">â””â”€â”€ nes
</span><span style="background-color:#2b303b;color:#c0c5ce;">    </span><span style="background-color:#2b303b;color:#c0c5ce;">â”œâ”€â”€ cpu
</span><span style="background-color:#2b303b;color:#c0c5ce;">    </span><span style="background-color:#2b303b;color:#c0c5ce;">â”‚Â Â  â””â”€â”€ mod.rs
</span><span style="background-color:#2b303b;color:#c0c5ce;">    </span><span style="background-color:#2b303b;color:#c0c5ce;">â”œâ”€â”€ mod.rs
</span><span style="background-color:#2b303b;color:#c0c5ce;">    </span><span style="background-color:#2b303b;color:#c0c5ce;">â””â”€â”€ ppu
</span><span style="background-color:#2b303b;color:#c0c5ce;">        </span><span style="background-color:#2b303b;color:#c0c5ce;">â””â”€â”€ mod.rs
</span></pre><h3 id="cpu"><a class="gutenberg-anchor" href="#cpu" aria-label="Anchor link for: cpu">ðŸ”—</a>
CPU</h3>
<p><code>nes/cpu/mod.rs</code></p>
<pre style="background-color:#2b303b">
<span style="background-color:#2b303b;color:#b48ead;">pub struct </span><span style="background-color:#2b303b;color:#c0c5ce;">Cpu {
</span><span style="background-color:#2b303b;color:#c0c5ce;">    </span><span style="background-color:#2b303b;color:#bf616a;">prg_ram</span><span style="background-color:#2b303b;color:#c0c5ce;">: PrgRam,
</span><span style="background-color:#2b303b;color:#c0c5ce;">}
</span><span style="background-color:#2b303b;color:#c0c5ce;">
</span><span style="background-color:#2b303b;color:#b48ead;">impl </span><span style="background-color:#2b303b;color:#c0c5ce;">Cpu {
</span><span style="background-color:#2b303b;color:#c0c5ce;">    </span><span style="background-color:#2b303b;color:#b48ead;">pub fn </span><span style="background-color:#2b303b;color:#8fa1b3;">new</span><span style="background-color:#2b303b;color:#c0c5ce;">(</span><span style="background-color:#2b303b;color:#bf616a;">prg_ram</span><span style="background-color:#2b303b;color:#c0c5ce;">: PrgRam) -&gt; Cpu {
</span><span style="background-color:#2b303b;color:#c0c5ce;">        </span><span style="background-color:#2b303b;color:#c0c5ce;">Cpu { prg_ram }
</span><span style="background-color:#2b303b;color:#c0c5ce;">    </span><span style="background-color:#2b303b;color:#c0c5ce;">}
</span><span style="background-color:#2b303b;color:#c0c5ce;">}
</span><span style="background-color:#2b303b;color:#c0c5ce;">
</span><span style="background-color:#2b303b;color:#b48ead;">pub struct </span><span style="background-color:#2b303b;color:#c0c5ce;">PrgRam {
</span><span style="background-color:#2b303b;color:#c0c5ce;">    </span><span style="background-color:#2b303b;color:#bf616a;">memory</span><span style="background-color:#2b303b;color:#c0c5ce;">: Box&lt;[</span><span style="background-color:#2b303b;color:#b48ead;">u8</span><span style="background-color:#2b303b;color:#c0c5ce;">; </span><span style="background-color:#2b303b;color:#d08770;">0xFFFF</span><span style="background-color:#2b303b;color:#c0c5ce;">]&gt;,
</span><span style="background-color:#2b303b;color:#c0c5ce;">    </span><span style="background-color:#2b303b;color:#bf616a;">v_ram</span><span style="background-color:#2b303b;color:#c0c5ce;">: Arc&lt;Mutex&lt;VRam&gt;&gt;,
</span><span style="background-color:#2b303b;color:#c0c5ce;">}
</span><span style="background-color:#2b303b;color:#c0c5ce;">
</span><span style="background-color:#2b303b;color:#b48ead;">impl </span><span style="background-color:#2b303b;color:#c0c5ce;">PrgRam {
</span><span style="background-color:#2b303b;color:#c0c5ce;">    </span><span style="background-color:#2b303b;color:#b48ead;">pub fn </span><span style="background-color:#2b303b;color:#8fa1b3;">new</span><span style="background-color:#2b303b;color:#c0c5ce;">(</span><span style="background-color:#2b303b;color:#bf616a;">memory</span><span style="background-color:#2b303b;color:#c0c5ce;">: Box&lt;[</span><span style="background-color:#2b303b;color:#b48ead;">u8</span><span style="background-color:#2b303b;color:#c0c5ce;">; </span><span style="background-color:#2b303b;color:#d08770;">0xFFFF</span><span style="background-color:#2b303b;color:#c0c5ce;">]&gt;, </span><span style="background-color:#2b303b;color:#bf616a;">v_ram</span><span style="background-color:#2b303b;color:#c0c5ce;">: Arc&lt;Mutex&lt;VRam&gt;&gt;) -&gt; PrgRam {
</span><span style="background-color:#2b303b;color:#c0c5ce;">        </span><span style="background-color:#2b303b;color:#c0c5ce;">PrgRam { memory, v_ram }
</span><span style="background-color:#2b303b;color:#c0c5ce;">    </span><span style="background-color:#2b303b;color:#c0c5ce;">}
</span><span style="background-color:#2b303b;color:#c0c5ce;">}
</span></pre><h3 id="ppu"><a class="gutenberg-anchor" href="#ppu" aria-label="Anchor link for: ppu">ðŸ”—</a>
PPU</h3>
<p><code>nes/ppu/mod.rs</code></p>
<pre style="background-color:#2b303b">
<span style="background-color:#2b303b;color:#b48ead;">pub struct </span><span style="background-color:#2b303b;color:#c0c5ce;">Ppu {
</span><span style="background-color:#2b303b;color:#c0c5ce;">    </span><span style="background-color:#2b303b;color:#bf616a;">v_ram</span><span style="background-color:#2b303b;color:#c0c5ce;">: Arc&lt;Mutex&lt;VRam&gt;&gt;,
</span><span style="background-color:#2b303b;color:#c0c5ce;">}
</span><span style="background-color:#2b303b;color:#c0c5ce;">
</span><span style="background-color:#2b303b;color:#b48ead;">impl </span><span style="background-color:#2b303b;color:#c0c5ce;">Ppu {
</span><span style="background-color:#2b303b;color:#c0c5ce;">    </span><span style="background-color:#2b303b;color:#b48ead;">pub fn </span><span style="background-color:#2b303b;color:#8fa1b3;">new</span><span style="background-color:#2b303b;color:#c0c5ce;">(</span><span style="background-color:#2b303b;color:#bf616a;">v_ram</span><span style="background-color:#2b303b;color:#c0c5ce;">: Arc&lt;Mutex&lt;VRam&gt;&gt;) -&gt; Ppu {
</span><span style="background-color:#2b303b;color:#c0c5ce;">        </span><span style="background-color:#2b303b;color:#c0c5ce;">Ppu { v_ram }
</span><span style="background-color:#2b303b;color:#c0c5ce;">    </span><span style="background-color:#2b303b;color:#c0c5ce;">}
</span><span style="background-color:#2b303b;color:#c0c5ce;">}
</span><span style="background-color:#2b303b;color:#c0c5ce;">
</span><span style="background-color:#2b303b;color:#b48ead;">pub struct </span><span style="background-color:#2b303b;color:#c0c5ce;">VRam(Box&lt;[</span><span style="background-color:#2b303b;color:#b48ead;">u8</span><span style="background-color:#2b303b;color:#c0c5ce;">; </span><span style="background-color:#2b303b;color:#d08770;">0xFFFF</span><span style="background-color:#2b303b;color:#c0c5ce;">]&gt;);
</span><span style="background-color:#2b303b;color:#b48ead;">impl </span><span style="background-color:#2b303b;color:#c0c5ce;">VRam {
</span><span style="background-color:#2b303b;color:#c0c5ce;">    </span><span style="background-color:#2b303b;color:#b48ead;">pub fn </span><span style="background-color:#2b303b;color:#8fa1b3;">new</span><span style="background-color:#2b303b;color:#c0c5ce;">(</span><span style="background-color:#2b303b;color:#bf616a;">memory</span><span style="background-color:#2b303b;color:#c0c5ce;">: Box&lt;[</span><span style="background-color:#2b303b;color:#b48ead;">u8</span><span style="background-color:#2b303b;color:#c0c5ce;">; </span><span style="background-color:#2b303b;color:#d08770;">0xFFFF</span><span style="background-color:#2b303b;color:#c0c5ce;">]&gt;) -&gt; VRam {
</span><span style="background-color:#2b303b;color:#c0c5ce;">        </span><span style="background-color:#2b303b;color:#c0c5ce;">VRam(memory)
</span><span style="background-color:#2b303b;color:#c0c5ce;">    </span><span style="background-color:#2b303b;color:#c0c5ce;">}
</span><span style="background-color:#2b303b;color:#c0c5ce;">}
</span></pre><h2 id="debug"><a class="gutenberg-anchor" href="#debug" aria-label="Anchor link for: debug">ðŸ”—</a>
debug</h2>

</div>

        </div>

    <script src="/livereload.js?port=1112&mindelay=10"></script></body>

</html>
